{"ast":null,"code":"var _jsxFileName = \"/Users/robinmarillia/Documents/dev/homeView/src/index.js\";\nimport React, { Component } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport * as THREE from \"three\";\nimport { WEBVR } from 'three/examples/jsm/vr/WebVR.js';\nimport \"./index.css\";\nimport rooms from \"./json/rooms.json\";\n/*---------------------------------------------------------------\n\n            Cette classe génère la scène 360\n\n------------------------------------------------------------------*/\n\nclass Frame360 extends Component {\n  constructor(props) {\n    super(props); // on initialise les refs\n\n    this.frameRef = React.createRef(); // on initialise les states\n\n    this.state = {\n      room: this.props.room\n    };\n  }\n\n  componentDidMount() {\n    //this.setState({ renderer: WEBVR.createButton( renderer, { referenceSpaceType: 'local' } ) });\n    // on ajoute l'élément au composant react\n    var camera, scene, renderer;\n    var isUserInteracting = false,\n        onMouseDownMouseX = 0,\n        onMouseDownMouseY = 0,\n        lon = 0,\n        onMouseDownLon = 0,\n        lat = 0,\n        onMouseDownLat = 0,\n        phi = 0,\n        theta = 0; // on récupère la room\n\n    var room = this.state.room; // on active le frame\n\n    var frame = init(room);\n    this.frameRef = frame;\n    animate();\n\n    function init(room) {\n      var mesh;\n      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1100);\n      camera.target = new THREE.Vector3(0, 0, 0);\n      scene = new THREE.Scene();\n      var geometry = new THREE.SphereBufferGeometry(500, 60, 40); // invert the geometry on the x-axis so that all of the faces point inward\n\n      geometry.scale(-1, 1, 1);\n      var texture = new THREE.TextureLoader().load(process.env.PUBLIC_URL + '/img/' + room);\n      var material = new THREE.MeshBasicMaterial({\n        map: texture\n      });\n      mesh = new THREE.Mesh(geometry, material);\n      scene.add(mesh);\n      renderer = new THREE.WebGLRenderer();\n      renderer.setPixelRatio(window.devicePixelRatio);\n      renderer.setSize(window.innerWidth, window.innerHeight);\n      document.addEventListener('mousedown', onPointerStart, false);\n      document.addEventListener('mousemove', onPointerMove, false);\n      document.addEventListener('mouseup', onPointerUp, false);\n      document.addEventListener('wheel', onDocumentMouseWheel, false);\n      document.addEventListener('touchstart', onPointerStart, false);\n      document.addEventListener('touchmove', onPointerMove, false);\n      document.addEventListener('touchend', onPointerUp, false);\n      document.addEventListener('dragover', function (event) {\n        event.preventDefault();\n        event.dataTransfer.dropEffect = 'copy';\n      }, false);\n      document.addEventListener('dragenter', function () {\n        document.body.style.opacity = 0.5;\n      }, false);\n      document.addEventListener('dragleave', function () {\n        document.body.style.opacity = 1;\n      }, false);\n      document.addEventListener('drop', function (event) {\n        event.preventDefault();\n        var reader = new FileReader();\n        reader.addEventListener('load', function (event) {\n          material.map.image.src = event.target.result;\n          material.map.needsUpdate = true;\n        }, false);\n        reader.readAsDataURL(event.dataTransfer.files[0]);\n        document.body.style.opacity = 1;\n      }, false); //\n\n      window.addEventListener('resize', onWindowResize, false);\n      return renderer.domElement;\n    }\n\n    function onWindowResize() {\n      camera.aspect = window.innerWidth / window.innerHeight;\n      camera.updateProjectionMatrix();\n      renderer.setSize(window.innerWidth, window.innerHeight);\n    }\n\n    function onPointerStart(event) {\n      isUserInteracting = true;\n      var clientX = event.clientX || event.touches[0].clientX;\n      var clientY = event.clientY || event.touches[0].clientY;\n      onMouseDownMouseX = clientX;\n      onMouseDownMouseY = clientY;\n      onMouseDownLon = lon;\n      onMouseDownLat = lat;\n    }\n\n    function onPointerMove(event) {\n      if (isUserInteracting === true) {\n        var clientX = event.clientX || event.touches[0].clientX;\n        var clientY = event.clientY || event.touches[0].clientY;\n        lon = (onMouseDownMouseX - clientX) * 0.1 + onMouseDownLon;\n        lat = (clientY - onMouseDownMouseY) * 0.1 + onMouseDownLat;\n      }\n    }\n\n    function onPointerUp() {\n      isUserInteracting = false;\n    }\n\n    function onDocumentMouseWheel(event) {\n      var fov = camera.fov + event.deltaY * 0.05;\n      camera.fov = THREE.Math.clamp(fov, 10, 75);\n      camera.updateProjectionMatrix();\n    }\n\n    function animate() {\n      requestAnimationFrame(animate);\n      update();\n    }\n\n    function update() {\n      lat = Math.max(-85, Math.min(85, lat));\n      phi = THREE.Math.degToRad(90 - lat);\n      theta = THREE.Math.degToRad(lon);\n      camera.target.x = 500 * Math.sin(phi) * Math.cos(theta);\n      camera.target.y = 500 * Math.cos(phi);\n      camera.target.z = 500 * Math.sin(phi) * Math.sin(theta);\n      camera.lookAt(camera.target);\n      /*\n      // distortion\n      camera.position.copy( camera.target ).negate();\n      */\n\n      renderer.render(scene, camera);\n    }\n  }\n\n  render() {\n    return React.createElement(\"section\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"itemRoom\",\n      ref: this.frameRef,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218\n      },\n      __self: this\n    }));\n  }\n\n}\n/*---------------------------------------------------------------\n\n                Cette classe génère la scène VR\n\n------------------------------------------------------------------*/\n\n\nclass FrameVR extends Component {\n  constructor(props) {\n    super(props); // on initialise les refs\n\n    this.frameRef = React.createRef();\n    this.btnVRRef = React.createRef(); // on initialise les états\n\n    this.state = {\n      room: this.props.room\n    };\n  }\n\n  componentDidMount() {\n    // on récupère la room\n    var room = this.state.room; // on active le frame\n\n    var frame = init(room);\n    this.mount.appendChild(frame);\n    var camera;\n    var renderer;\n    var scene;\n    init();\n    animate();\n\n    function init(room) {\n      renderer = new THREE.WebGLRenderer();\n      renderer.setPixelRatio(window.devicePixelRatio);\n      renderer.setSize(window.innerWidth, window.innerHeight);\n      renderer.vr.enabled = true;\n      this.frameRef.appendChild(renderer.domElement);\n      document.body.appendChild(WEBVR.createButton(renderer, {\n        referenceSpaceType: 'local'\n      })); //\n\n      scene = new THREE.Scene();\n      camera = new THREE.PerspectiveCamera(90, window.innerWidth / window.innerHeight, 1, 1000);\n      camera.layers.enable(1);\n      var geometry = new THREE.BoxBufferGeometry(100, 100, 100);\n      geometry.scale(1, 1, -1);\n      var textures = getTexturesFromAtlasFile(\"textures/cube/sun_temple_stripe_stereo.jpg\", 12);\n      var materials = [];\n\n      for (var i = 0; i < 6; i++) {\n        materials.push(new THREE.MeshBasicMaterial({\n          map: textures[i]\n        }));\n      }\n\n      var skyBox = new THREE.Mesh(geometry, materials);\n      skyBox.layers.set(1);\n      scene.add(skyBox);\n      var materialsR = [];\n\n      for (var i = 6; i < 12; i++) {\n        materialsR.push(new THREE.MeshBasicMaterial({\n          map: textures[i]\n        }));\n      }\n\n      var skyBoxR = new THREE.Mesh(geometry, materialsR);\n      skyBoxR.layers.set(2);\n      scene.add(skyBoxR);\n      window.addEventListener('resize', onWindowResize, false);\n    }\n\n    function getTexturesFromAtlasFile(atlasImgUrl, tilesNum) {\n      var textures = [];\n\n      for (var i = 0; i < tilesNum; i++) {\n        textures[i] = new THREE.Texture();\n      }\n\n      var loader = new THREE.ImageLoader();\n      loader.load(atlasImgUrl, function (imageObj) {\n        var canvas, context;\n        var tileWidth = imageObj.height;\n\n        for (var i = 0; i < textures.length; i++) {\n          canvas = document.createElement('canvas');\n          context = canvas.getContext('2d');\n          canvas.height = tileWidth;\n          canvas.width = tileWidth;\n          context.drawImage(imageObj, tileWidth * i, 0, tileWidth, tileWidth, 0, 0, tileWidth, tileWidth);\n          textures[i].image = canvas;\n          textures[i].needsUpdate = true;\n        }\n      });\n      return textures;\n    }\n\n    function onWindowResize() {\n      camera.aspect = window.innerWidth / window.innerHeight;\n      camera.updateProjectionMatrix();\n      renderer.setSize(window.innerWidth, window.innerHeight);\n    }\n\n    function animate() {\n      renderer.setAnimationLoop(render);\n    }\n\n    function render() {\n      renderer.render(scene, camera);\n    }\n  }\n\n  render() {\n    return React.createElement(\"section\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 371\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"itemRoom\",\n      ref: this.frameRef,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 372\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"vrEnabled\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 373\n      },\n      __self: this\n    }));\n  }\n\n}\n/*---------------------------------------------------------------\n\nCette classe génère un item de la ligne de pièce\n\n------------------------------------------------------------------*/\n\n\nclass ItemNavRooms extends Component {\n  render() {\n    var filename = process.env.PUBLIC_URL + '/img/' + this.props.filename;\n    return React.createElement(\"div\", {\n      className: \"navRoomItem\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 392\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"navRoomItemTitle\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 393\n      },\n      __self: this\n    }, this.props.room), React.createElement(\"img\", {\n      src: filename,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 394\n      },\n      __self: this\n    }));\n  }\n\n}\n/*---------------------------------------------------------------\n\nCette classe génère une ligne de pièces en fonction d'une date\ndonnée par le parent\n\n------------------------------------------------------------------*/\n\n\nclass LineNavRooms extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      frameVRSize: \"small\",\n      room: \"room4-salon-291019.JPG\"\n    };\n  }\n\n  render() {\n    // on va remplir un tableau d'élément jsx\n    var roomsRender = [];\n    var content = this.props.content; // on scan chaque élément du json\n\n    content.forEach(element => {\n      var filename = element.filename;\n      var name = element.name; // on donne au parent un tableau contenant la page voulue et la photo 360\n      // on envoit d'abord vers le 360\n\n      var arrayReturn = [\"frame360\", filename]; // on remplit le tableau\n\n      roomsRender.push(React.createElement(\"div\", {\n        className: \"navRoomsFlex\",\n        onClick: () => this.props.page(arrayReturn),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 438\n        },\n        __self: this\n      }, React.createElement(ItemNavRooms, {\n        room: name,\n        filename: filename,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 438\n        },\n        __self: this\n      })));\n    });\n    return React.createElement(\"div\", {\n      className: \"lineNavRooms\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 442\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"navRoomsDate\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 443\n      },\n      __self: this\n    }, this.props.date), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 443\n      },\n      __self: this\n    }), React.createElement(\"nav\", {\n      className: \"navRooms\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 444\n      },\n      __self: this\n    }, roomsRender));\n  }\n\n}\n/*---------------------------------------------------------------\n\nIci on affiche plusieurs choses différentes selon l'état PAGE.\n- Si page vaut home on affiche le menu\n- Si page vaut frame360 on affiche la sphere draggable\n- Si page vaut frameVR on créé la scene VR\n\n------------------------------------------------------------------*/\n\n\nclass App extends Component {\n  constructor(props) {\n    super(props); // l'état par défaut de la page est home et il n'y a pas d'image sur la page home\n\n    this.state = {\n      page: \"home\",\n      filename: \"\"\n    };\n    this.childHandler = this.childHandler.bind(this);\n  } // on récupère les infos de l'enfant, ici un tableau\n\n\n  childHandler(dataFromChild) {\n    var pageReturn = dataFromChild[0];\n    var filenameReturn = dataFromChild[1];\n    this.setState({\n      page: pageReturn,\n      filename: filenameReturn\n    });\n  }\n\n  render() {\n    // on va remplir un tableau d'élément jsx\n    var lineRender = []; // on scan chaque élément du json\n\n    rooms.forEach(element => {\n      // on récupère la date\n      var date = element.date; // on rédcupère le sous tableau correspondant à la date\n\n      var content = element.content; // on remplit le tableau qui récupère l'information du click de l'enfant\n\n      lineRender.push(React.createElement(LineNavRooms, {\n        page: this.childHandler,\n        date: date,\n        content: content,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 499\n        },\n        __self: this\n      }));\n    }); // on dispatch selon l'état\n\n    var page = this.state.page;\n\n    if (page == \"home\") {\n      var pageWrapper = React.createElement(\"section\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 505\n        },\n        __self: this\n      }, React.createElement(\"header\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 506\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 506\n        },\n        __self: this\n      }, \"HomeView | Questembert\")), React.createElement(\"section\", {\n        className: \"homeContainer\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 507\n        },\n        __self: this\n      }, lineRender));\n    } else if (page == \"frame360\") {\n      var pageWrapper = React.createElement(\"section\", {\n        className: \"FrameContainer\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 511\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"FrameReturn\",\n        onClick: () => this.setState({\n          page: \"home\"\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 512\n        },\n        __self: this\n      }, \"Retour\"), React.createElement(Frame360, {\n        room: this.state.filename,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 513\n        },\n        __self: this\n      }));\n    } else if (page == \"frameVR\") {\n      var pageWrapper = React.createElement(\"section\", {\n        className: \"FrameContainer\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 517\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"FrameReturn\",\n        onClick: () => this.setState({\n          page: \"home\"\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 518\n        },\n        __self: this\n      }, \"Retour\"), React.createElement(Frame360, {\n        room: this.state.filename,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 519\n        },\n        __self: this\n      }));\n    }\n\n    return React.createElement(\"section\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 524\n      },\n      __self: this\n    }, pageWrapper);\n  }\n\n}\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render(React.createElement(App, {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 533\n  },\n  __self: this\n}), rootElement);","map":{"version":3,"sources":["/Users/robinmarillia/Documents/dev/homeView/src/index.js"],"names":["React","Component","ReactDOM","THREE","WEBVR","rooms","Frame360","constructor","props","frameRef","createRef","state","room","componentDidMount","camera","scene","renderer","isUserInteracting","onMouseDownMouseX","onMouseDownMouseY","lon","onMouseDownLon","lat","onMouseDownLat","phi","theta","frame","init","animate","mesh","PerspectiveCamera","window","innerWidth","innerHeight","target","Vector3","Scene","geometry","SphereBufferGeometry","scale","texture","TextureLoader","load","process","env","PUBLIC_URL","material","MeshBasicMaterial","map","Mesh","add","WebGLRenderer","setPixelRatio","devicePixelRatio","setSize","document","addEventListener","onPointerStart","onPointerMove","onPointerUp","onDocumentMouseWheel","event","preventDefault","dataTransfer","dropEffect","body","style","opacity","reader","FileReader","image","src","result","needsUpdate","readAsDataURL","files","onWindowResize","domElement","aspect","updateProjectionMatrix","clientX","touches","clientY","fov","deltaY","Math","clamp","requestAnimationFrame","update","max","min","degToRad","x","sin","cos","y","z","lookAt","render","FrameVR","btnVRRef","mount","appendChild","vr","enabled","createButton","referenceSpaceType","layers","enable","BoxBufferGeometry","textures","getTexturesFromAtlasFile","materials","i","push","skyBox","set","materialsR","skyBoxR","atlasImgUrl","tilesNum","Texture","loader","ImageLoader","imageObj","canvas","context","tileWidth","height","length","createElement","getContext","width","drawImage","setAnimationLoop","ItemNavRooms","filename","LineNavRooms","frameVRSize","roomsRender","content","forEach","element","name","arrayReturn","page","date","App","childHandler","bind","dataFromChild","pageReturn","filenameReturn","setState","lineRender","pageWrapper","rootElement","getElementById"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport * as THREE from \"three\";\nimport { WEBVR } from 'three/examples/jsm/vr/WebVR.js';\nimport \"./index.css\";\nimport rooms from \"./json/rooms.json\";\n\n/*---------------------------------------------------------------\n\n            Cette classe génère la scène 360\n\n------------------------------------------------------------------*/\n\nclass Frame360 extends Component {\n  constructor(props) {\n    super(props);\n\n    // on initialise les refs\n    this.frameRef = React.createRef();\n\n    // on initialise les states\n    this.state = {\n       room: this.props.room\n       };\n  }\n  componentDidMount() {\n\n    //this.setState({ renderer: WEBVR.createButton( renderer, { referenceSpaceType: 'local' } ) });\n    // on ajoute l'élément au composant react\n\n    var camera, scene, renderer;\n\n\t\tvar isUserInteracting = false,\n\t\t\t\tonMouseDownMouseX = 0, onMouseDownMouseY = 0,\n\t\t\t\tlon = 0, onMouseDownLon = 0,\n\t\t\t\tlat = 0, onMouseDownLat = 0,\n\t\t\t\tphi = 0, theta = 0;\n\n    // on récupère la room\n    var room = this.state.room;\n\n    // on active le frame\n    var frame = init(room);\n\n    this.frameRef = frame ;\n\t\tanimate();\n\n\n\n\n    function init(room) {\n\n        var mesh;\n\n\n        camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 1100 );\n        camera.target = new THREE.Vector3( 0, 0, 0 );\n\n        scene = new THREE.Scene();\n\n        var geometry = new THREE.SphereBufferGeometry( 500, 60, 40 );\n        // invert the geometry on the x-axis so that all of the faces point inward\n        geometry.scale( -1, 1, 1 );\n\n        var texture = new THREE.TextureLoader().load( process.env.PUBLIC_URL + '/img/'+room );\n\n        var material = new THREE.MeshBasicMaterial( { map: texture } );\n\n        mesh = new THREE.Mesh( geometry, material );\n\n        scene.add( mesh );\n\n        renderer = new THREE.WebGLRenderer();\n        renderer.setPixelRatio( window.devicePixelRatio );\n        renderer.setSize( window.innerWidth, window.innerHeight );\n\n        document.addEventListener( 'mousedown', onPointerStart, false );\n        document.addEventListener( 'mousemove', onPointerMove, false );\n        document.addEventListener( 'mouseup', onPointerUp, false );\n\n        document.addEventListener( 'wheel', onDocumentMouseWheel, false );\n\n        document.addEventListener( 'touchstart', onPointerStart, false );\n        document.addEventListener( 'touchmove', onPointerMove, false );\n        document.addEventListener( 'touchend', onPointerUp, false );\n\n\n        document.addEventListener( 'dragover', function ( event ) {\n\n          event.preventDefault();\n          event.dataTransfer.dropEffect = 'copy';\n\n        }, false );\n\n        document.addEventListener( 'dragenter', function () {\n\n          document.body.style.opacity = 0.5;\n\n        }, false );\n\n        document.addEventListener( 'dragleave', function () {\n\n          document.body.style.opacity = 1;\n\n        }, false );\n\n        document.addEventListener( 'drop', function ( event ) {\n\n          event.preventDefault();\n\n          var reader = new FileReader();\n          reader.addEventListener( 'load', function ( event ) {\n\n            material.map.image.src = event.target.result;\n            material.map.needsUpdate = true;\n\n          }, false );\n          reader.readAsDataURL( event.dataTransfer.files[ 0 ] );\n\n          document.body.style.opacity = 1;\n\n        }, false );\n\n        //\n\n        window.addEventListener( 'resize', onWindowResize, false );\n\n        return(renderer.domElement);\n      }\n\n\n    function onWindowResize() {\n\n        camera.aspect = window.innerWidth / window.innerHeight;\n        camera.updateProjectionMatrix();\n\n        renderer.setSize( window.innerWidth, window.innerHeight );\n\n      }\n\n    function onPointerStart( event ) {\n        isUserInteracting = true;\n\n        var clientX = event.clientX || event.touches[ 0 ].clientX;\n        var clientY = event.clientY || event.touches[ 0 ].clientY;\n\n        onMouseDownMouseX = clientX;\n        onMouseDownMouseY = clientY;\n\n        onMouseDownLon = lon;\n        onMouseDownLat = lat;\n\n      }\n\n    function onPointerMove( event ) {\n        if ( isUserInteracting === true ) {\n\n          var clientX = event.clientX || event.touches[ 0 ].clientX;\n          var clientY = event.clientY || event.touches[ 0 ].clientY;\n\n          lon = ( onMouseDownMouseX - clientX ) * 0.1 + onMouseDownLon;\n          lat = ( clientY - onMouseDownMouseY ) * 0.1 + onMouseDownLat;\n\n        }\n\n      }\n\n    function onPointerUp() {\n\n        isUserInteracting = false;\n\n      }\n\n    function onDocumentMouseWheel( event ) {\n        var fov = camera.fov + event.deltaY * 0.05;\n\n        camera.fov = THREE.Math.clamp( fov, 10, 75 );\n\n        camera.updateProjectionMatrix();\n\n      }\n\n    function animate() {\n\n\n        requestAnimationFrame( animate );\n        update();\n\n      }\n\n    function update() {\n\n        lat = Math.max( - 85, Math.min( 85, lat ) );\n        phi = THREE.Math.degToRad( 90 - lat );\n        theta = THREE.Math.degToRad( lon );\n\n        camera.target.x = 500 * Math.sin( phi ) * Math.cos( theta );\n        camera.target.y = 500 * Math.cos( phi );\n        camera.target.z = 500 * Math.sin( phi ) * Math.sin( theta );\n\n        camera.lookAt( camera.target );\n\n        /*\n        // distortion\n        camera.position.copy( camera.target ).negate();\n        */\n\n        renderer.render( scene, camera );\n\n      }\n\n  }\n\n\n  render() {\n    return (\n      <section>\n        <div className=\"itemRoom\" ref={this.frameRef} />\n      </section>\n    )\n  }\n}\n/*---------------------------------------------------------------\n\n                Cette classe génère la scène VR\n\n------------------------------------------------------------------*/\nclass FrameVR extends Component {\n  constructor(props) {\n    super(props);\n\n    // on initialise les refs\n    this.frameRef = React.createRef();\n    this.btnVRRef = React.createRef();\n\n    // on initialise les états\n    this.state = {\n       room: this.props.room\n       };\n  }\n  componentDidMount() {\n\n\n    // on récupère la room\n    var room = this.state.room;\n\n    // on active le frame\n    var frame = init(room);\n\n    this.mount.appendChild( frame );\n\n    var camera;\n  \tvar renderer;\n  \tvar scene;\n\n  \tinit();\n  \tanimate();\n\n  \tfunction init(room) {\n\n  \t\trenderer = new THREE.WebGLRenderer();\n  \t\trenderer.setPixelRatio( window.devicePixelRatio );\n  \t\trenderer.setSize( window.innerWidth, window.innerHeight );\n  \t\trenderer.vr.enabled = true;\n  \t\tthis.frameRef.appendChild( renderer.domElement );\n\n  \t\tdocument.body.appendChild( WEBVR.createButton( renderer, { referenceSpaceType: 'local' } ) );\n\n  \t\t//\n\n  \t\tscene = new THREE.Scene();\n\n  \t\tcamera = new THREE.PerspectiveCamera( 90, window.innerWidth / window.innerHeight, 1, 1000 );\n  \t\tcamera.layers.enable( 1 );\n\n  \t\tvar geometry = new THREE.BoxBufferGeometry( 100, 100, 100 );\n  \t\tgeometry.scale( 1, 1, - 1 );\n  \t\tvar textures = getTexturesFromAtlasFile( \"textures/cube/sun_temple_stripe_stereo.jpg\", 12 );\n\n  \t\tvar materials = [];\n\n  \t\tfor ( var i = 0; i < 6; i ++ ) {\n\n  \t\t\tmaterials.push( new THREE.MeshBasicMaterial( { map: textures[ i ] } ) );\n\n  \t\t}\n\n  \t\tvar skyBox = new THREE.Mesh( geometry, materials );\n  \t\tskyBox.layers.set( 1 );\n  \t\tscene.add( skyBox );\n\n\n  \t\tvar materialsR = [];\n\n  \t\tfor ( var i = 6; i < 12; i ++ ) {\n\n  \t\t\tmaterialsR.push( new THREE.MeshBasicMaterial( { map: textures[ i ] } ) );\n\n  \t\t}\n\n  \t\tvar skyBoxR = new THREE.Mesh( geometry, materialsR );\n  \t\tskyBoxR.layers.set( 2 );\n  \t\tscene.add( skyBoxR );\n\n  \t\twindow.addEventListener( 'resize', onWindowResize, false );\n\n  \t}\n\n  \tfunction getTexturesFromAtlasFile( atlasImgUrl, tilesNum ) {\n\n  \t\tvar textures = [];\n\n  \t\tfor ( var i = 0; i < tilesNum; i ++ ) {\n\n  \t\t\ttextures[ i ] = new THREE.Texture();\n\n  \t\t}\n\n  \t\tvar loader = new THREE.ImageLoader();\n  \t\tloader.load( atlasImgUrl, function ( imageObj ) {\n\n  \t\t\tvar canvas, context;\n  \t\t\tvar tileWidth = imageObj.height;\n\n  \t\t\tfor ( var i = 0; i < textures.length; i ++ ) {\n\n  \t\t\t\tcanvas = document.createElement( 'canvas' );\n  \t\t\t\tcontext = canvas.getContext( '2d' );\n  \t\t\t\tcanvas.height = tileWidth;\n  \t\t\t\tcanvas.width = tileWidth;\n  \t\t\t\tcontext.drawImage( imageObj, tileWidth * i, 0, tileWidth, tileWidth, 0, 0, tileWidth, tileWidth );\n  \t\t\t\ttextures[ i ].image = canvas;\n  \t\t\t\ttextures[ i ].needsUpdate = true;\n\n  \t\t\t}\n\n  \t\t} );\n\n  \t\treturn textures;\n\n  \t}\n\n  \tfunction onWindowResize() {\n\n  \t\tcamera.aspect = window.innerWidth / window.innerHeight;\n  \t\tcamera.updateProjectionMatrix();\n\n  \t\trenderer.setSize( window.innerWidth, window.innerHeight );\n\n  \t}\n\n  \tfunction animate() {\n\n  \t\trenderer.setAnimationLoop( render );\n\n  \t}\n\n  \tfunction render() {\n\n  \t\trenderer.render( scene, camera );\n\n  \t}\n\n\n\n  }\n\n\n  render() {\n    return (\n        <section>\n          <div className=\"itemRoom\" ref={this.frameRef} />\n          <div className=\"vrEnabled\"/>\n        </section>\n    )\n  }\n}\n\n\n\n\n/*---------------------------------------------------------------\n\nCette classe génère un item de la ligne de pièce\n\n------------------------------------------------------------------*/\nclass ItemNavRooms extends Component {\n\n  render(){\n    var filename = process.env.PUBLIC_URL + '/img/'+this.props.filename;\n    return(\n      <div className=\"navRoomItem\">\n        <div className=\"navRoomItemTitle\">{this.props.room}</div>\n        <img src={filename}/>\n      </div>\n    )\n\n  }\n\n\n}\n\n/*---------------------------------------------------------------\n\nCette classe génère une ligne de pièces en fonction d'une date\ndonnée par le parent\n\n------------------------------------------------------------------*/\nclass LineNavRooms extends Component {\n  constructor(props) {\n      super(props)\n      this.state = {\n          frameVRSize: \"small\",\n          room: \"room4-salon-291019.JPG\"\n      };\n  }\n\n\n\n\n  render() {\n\n    // on va remplir un tableau d'élément jsx\n    var roomsRender = [];\n    var content = this.props.content;\n    // on scan chaque élément du json\n    content.forEach((element) => {\n\n      var filename = element.filename;\n\n      var name = element.name;\n\n      // on donne au parent un tableau contenant la page voulue et la photo 360\n      // on envoit d'abord vers le 360\n      var arrayReturn = [\"frame360\", filename];\n\n      // on remplit le tableau\n      roomsRender.push(<div className=\"navRoomsFlex\" onClick={()=> this.props.page(arrayReturn)} ><ItemNavRooms room={name} filename={filename}/></div>);\n    });\n\n    return (\n      <div className=\"lineNavRooms\">\n        <div className=\"navRoomsDate\">{this.props.date}</div><br/>\n        <nav className=\"navRooms\">\n          {/*<SelectRoom action={this.childHandler}/>*/}\n\n          {roomsRender}\n        </nav>\n      </div>\n    )\n  }\n}\n/*---------------------------------------------------------------\n\nIci on affiche plusieurs choses différentes selon l'état PAGE.\n- Si page vaut home on affiche le menu\n- Si page vaut frame360 on affiche la sphere draggable\n- Si page vaut frameVR on créé la scene VR\n\n------------------------------------------------------------------*/\nclass App extends Component {\n  constructor(props) {\n      super(props)\n      // l'état par défaut de la page est home et il n'y a pas d'image sur la page home\n      this.state = {\n          page: \"home\",\n          filename: \"\"\n\n      };\n      this.childHandler = this.childHandler.bind(this)\n  }\n\n\n  // on récupère les infos de l'enfant, ici un tableau\n  childHandler(dataFromChild) {\n\n        var pageReturn = dataFromChild[0];\n        var filenameReturn = dataFromChild[1];\n        this.setState({\n            page: pageReturn,\n            filename: filenameReturn\n        });\n\n  }\n\n  render() {\n\n    // on va remplir un tableau d'élément jsx\n    var lineRender = [];\n    // on scan chaque élément du json\n    rooms.forEach((element) => {\n      // on récupère la date\n      var date = element.date;\n\n      // on rédcupère le sous tableau correspondant à la date\n      var content = element.content;\n\n      // on remplit le tableau qui récupère l'information du click de l'enfant\n      lineRender.push(<LineNavRooms page={this.childHandler} date={date} content={content}/>);\n    });\n\n    // on dispatch selon l'état\n    var page = this.state.page;\n    if(page==\"home\"){\n      var pageWrapper = <section>\n                          <header><span>HomeView | Questembert</span></header>\n                          <section className=\"homeContainer\">{lineRender}</section>\n                        </section>\n    }\n    else if(page==\"frame360\"){\n      var pageWrapper = <section className=\"FrameContainer\">\n                          <span className=\"FrameReturn\" onClick={()=>this.setState({page:\"home\"})}>Retour</span>\n                          <Frame360 room={this.state.filename}/>\n                        </section>\n    }\n    else if(page==\"frameVR\"){\n      var pageWrapper = <section className=\"FrameContainer\">\n                          <span className=\"FrameReturn\" onClick={()=>this.setState({page:\"home\"})}>Retour</span>\n                          <Frame360 room={this.state.filename}/>\n                        </section>\n    }\n\n    return (\n      <section>\n\n        {pageWrapper}\n      </section>\n    )\n  }\n}\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render(<App />, rootElement);\n"]},"metadata":{},"sourceType":"module"}