{"ast":null,"code":"var _jsxFileName = \"/Users/robinmarillia/Documents/dev/homeView/src/index.js\";\nimport React, { Component } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport * as THREE from \"three\";\nimport { WEBVR } from 'three/examples/jsm/vr/WebVR.js';\nimport \"./index.css\";\nimport rooms from \"./json/rooms.json\";\n/*=================================================================\n                  STRUCTURE DES COMPOSANTS\n===================================================================\n\nOn navigue dans le composant App:\nSur la page d'accueil d'état HOME les scenes sont classées par date.\n\nOn a un composant qui génère une ligne de pièce par date.\n  Dans ce composant, un autre génère l'item clickable.\n\nAu clic on renvoit au composant App les informations de la scène cliquée.\nOn affiche alors un frame360 dont l'image est celle renvoyée par le click dans le menu.\n\n*/\n\n/*------------------------------------------------------------------------------\n\n  Cette classe génère l'affichage de l'item de navigation dans\n  une pièce à une date différente\n\n--------------------------------------------------------------------------------*/\n\nclass NavRoomDatesItem extends Component {\n  render() {\n    var currentDate = this.props.currentDate;\n    var idRoom = this.props.idRoom;\n    return React.createElement(\"div\", {\n      className: \"NavRoomDatesItem\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 38\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      src: process.env.PUBLIC_URL + '/img/' + this.props.filename,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 39\n      },\n      __self: this\n    }), React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 40\n      },\n      __self: this\n    }, this.props.date));\n  }\n\n}\n/*------------------------------------------------------------------------------\n\n  Cette classe génère la liste des différentes dates de modification d'une pièce\n\n--------------------------------------------------------------------------------*/\n\n\nclass NavRoomDates extends Component {\n  render() {\n    var currentDate = this.props.currentDate;\n    var idRoom = this.props.idRoom;\n    var navRender = []; // on scan chaque élément du json\n\n    rooms.forEach(element => {\n      // on récupère la date\n      var date = element.date;\n      var content = element.content;\n\n      if (currentDate != date) {\n        if (content.id == idRoom) {\n          var filenameOtherDate = content.filename;\n          navRender.push(React.createElement(NavRoomDatesItem, {\n            date: currentDate,\n            filename: filenameOtherDate,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 72\n            },\n            __self: this\n          }));\n        }\n      }\n    });\n    return React.createElement(\"div\", {\n      className: \"NavRoomDates\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 82\n      },\n      __self: this\n    }, navRender);\n  }\n\n}\n/*---------------------------------------------------------------\n\n            Cette classe génère la scène 360\n\n------------------------------------------------------------------*/\n\n\nclass Frame360 extends Component {\n  constructor(props) {\n    super(props); // on initialise les refs\n\n    this.frameRef = React.createRef(); // on initialise les states\n\n    this.state = {\n      id: this.props.idRoom,\n      room: this.props.filenameRoom\n    };\n  }\n\n  componentDidMount() {\n    //this.setState({ renderer: WEBVR.createButton( renderer, { referenceSpaceType: 'local' } ) });\n    // on ajoute l'élément au composant react\n    var camera, scene, renderer;\n    var isUserInteracting = false,\n        onMouseDownMouseX = 0,\n        onMouseDownMouseY = 0,\n        lon = 0,\n        onMouseDownLon = 0,\n        lat = 0,\n        onMouseDownLat = 0,\n        phi = 0,\n        theta = 0; // on récupère la room\n\n    var room = this.state.room; // on active le frame\n\n    var frame = init(room);\n    this.frameRef.appendChild(frame);\n    animate();\n\n    function init(room) {\n      var mesh;\n      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1100);\n      camera.target = new THREE.Vector3(0, 0, 0);\n      scene = new THREE.Scene();\n      var geometry = new THREE.SphereBufferGeometry(500, 60, 40); // invert the geometry on the x-axis so that all of the faces point inward\n\n      geometry.scale(-1, 1, 1);\n      var texture = new THREE.TextureLoader().load(process.env.PUBLIC_URL + '/img/' + room);\n      var material = new THREE.MeshBasicMaterial({\n        map: texture\n      });\n      mesh = new THREE.Mesh(geometry, material);\n      scene.add(mesh);\n      renderer = new THREE.WebGLRenderer();\n      renderer.setPixelRatio(window.devicePixelRatio);\n      renderer.setSize(window.innerWidth, window.innerHeight);\n      document.addEventListener('mousedown', onPointerStart, false);\n      document.addEventListener('mousemove', onPointerMove, false);\n      document.addEventListener('mouseup', onPointerUp, false);\n      document.addEventListener('wheel', onDocumentMouseWheel, false);\n      document.addEventListener('touchstart', onPointerStart, false);\n      document.addEventListener('touchmove', onPointerMove, false);\n      document.addEventListener('touchend', onPointerUp, false);\n      document.addEventListener('dragover', function (event) {\n        event.preventDefault();\n        event.dataTransfer.dropEffect = 'copy';\n      }, false);\n      document.addEventListener('dragenter', function () {\n        document.body.style.opacity = 0.5;\n      }, false);\n      document.addEventListener('dragleave', function () {\n        document.body.style.opacity = 1;\n      }, false);\n      document.addEventListener('drop', function (event) {\n        event.preventDefault();\n        var reader = new FileReader();\n        reader.addEventListener('load', function (event) {\n          material.map.image.src = event.target.result;\n          material.map.needsUpdate = true;\n        }, false);\n        reader.readAsDataURL(event.dataTransfer.files[0]);\n        document.body.style.opacity = 1;\n      }, false); //\n\n      window.addEventListener('resize', onWindowResize, false);\n      return renderer.domElement;\n    }\n\n    function onWindowResize() {\n      camera.aspect = window.innerWidth / window.innerHeight;\n      camera.updateProjectionMatrix();\n      renderer.setSize(window.innerWidth, window.innerHeight);\n    }\n\n    function onPointerStart(event) {\n      isUserInteracting = true;\n      var clientX = event.clientX || event.touches[0].clientX;\n      var clientY = event.clientY || event.touches[0].clientY;\n      onMouseDownMouseX = clientX;\n      onMouseDownMouseY = clientY;\n      onMouseDownLon = lon;\n      onMouseDownLat = lat;\n    }\n\n    function onPointerMove(event) {\n      if (isUserInteracting === true) {\n        var clientX = event.clientX || event.touches[0].clientX;\n        var clientY = event.clientY || event.touches[0].clientY;\n        lon = (onMouseDownMouseX - clientX) * 0.1 + onMouseDownLon;\n        lat = (clientY - onMouseDownMouseY) * 0.1 + onMouseDownLat;\n      }\n    }\n\n    function onPointerUp() {\n      isUserInteracting = false;\n    }\n\n    function onDocumentMouseWheel(event) {\n      var fov = camera.fov + event.deltaY * 0.05;\n      camera.fov = THREE.Math.clamp(fov, 10, 75);\n      camera.updateProjectionMatrix();\n    }\n\n    function animate() {\n      requestAnimationFrame(animate);\n      update();\n    }\n\n    function update() {\n      lat = Math.max(-85, Math.min(85, lat));\n      phi = THREE.Math.degToRad(90 - lat);\n      theta = THREE.Math.degToRad(lon);\n      camera.target.x = 500 * Math.sin(phi) * Math.cos(theta);\n      camera.target.y = 500 * Math.cos(phi);\n      camera.target.z = 500 * Math.sin(phi) * Math.sin(theta);\n      camera.lookAt(camera.target);\n      /*\n      // distortion\n      camera.position.copy( camera.target ).negate();\n      */\n\n      renderer.render(scene, camera);\n    }\n  }\n\n  render() {\n    return React.createElement(\"section\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 299\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"itemRoom\",\n      ref: ref => this.frameRef = ref,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300\n      },\n      __self: this\n    }));\n  }\n\n}\n/*---------------------------------------------------------------\n\n                Cette classe génère la scène VR\n\n------------------------------------------------------------------*/\n\n\nclass FrameVR extends Component {\n  constructor(props) {\n    super(props); // on initialise les refs\n\n    this.frameRef = React.createRef();\n    this.btnVRRef = React.createRef(); // on initialise les états\n\n    this.state = {\n      room: this.props.room\n    };\n  }\n\n  componentDidMount() {\n    // on récupère la room\n    var room = this.state.room; // on active le frame\n\n    var returnInit = init(room); // on ajoute le renderer\n\n    this.frameRef.appendChild(returnInit[0]); // on ajoute le bouton VR enable\n\n    this.buttonVRRef.appendChild(returnInit[1]);\n    var camera;\n    var renderer;\n    var scene;\n    animate();\n\n    function init(room) {\n      renderer = new THREE.WebGLRenderer();\n      renderer.setPixelRatio(window.devicePixelRatio);\n      renderer.setSize(window.innerWidth, window.innerHeight);\n      renderer.vr.enabled = true;\n      scene = new THREE.Scene();\n      camera = new THREE.PerspectiveCamera(90, window.innerWidth / window.innerHeight, 1, 1000);\n      camera.layers.enable(1);\n      var geometry = new THREE.SphereBufferGeometry(500, 60, 40); // invert the geometry on the x-axis so that all of the faces point inward\n\n      geometry.scale(-1, 1, 1);\n      var texture = new THREE.TextureLoader().load(process.env.PUBLIC_URL + '/img/' + room);\n      var material = new THREE.MeshBasicMaterial({\n        map: texture\n      });\n      var mesh = new THREE.Mesh(geometry, material);\n      scene.add(mesh);\n      window.addEventListener('resize', onWindowResize, false); // on retourne les éléments à ajouter au dom\n\n      return [renderer.domElement, WEBVR.createButton(renderer, {\n        referenceSpaceType: 'local'\n      })];\n    }\n\n    function onWindowResize() {\n      camera.aspect = window.innerWidth / window.innerHeight;\n      camera.updateProjectionMatrix();\n      renderer.setSize(window.innerWidth, window.innerHeight);\n    }\n\n    function animate() {\n      renderer.setAnimationLoop(render);\n    }\n\n    function render() {\n      renderer.render(scene, camera);\n    }\n  }\n\n  render() {\n    return React.createElement(\"section\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 404\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"itemRoom\",\n      ref: ref => this.frameRef = ref,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 405\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"vrEnabled\",\n      ref: ref => this.buttonVRRef = ref,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 406\n      },\n      __self: this\n    }));\n  }\n\n}\n/*---------------------------------------------------------------\n\nCette classe génère un item de la ligne de pièce\n\n------------------------------------------------------------------*/\n\n\nclass ItemNavRooms extends Component {\n  render() {\n    var filename = process.env.PUBLIC_URL + '/img/' + this.props.filename;\n    return React.createElement(\"div\", {\n      className: \"navRoomItem\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 425\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"navRoomItemTitle\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 426\n      },\n      __self: this\n    }, this.props.room), React.createElement(\"img\", {\n      src: filename,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 427\n      },\n      __self: this\n    }));\n  }\n\n}\n/*---------------------------------------------------------------\n\nCette classe génère une ligne de pièces en fonction d'une date\ndonnée par le parent\n\n------------------------------------------------------------------*/\n\n\nclass LineNavRooms extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      frameVRSize: \"small\",\n      room: \"room4-salon-291019.JPG\"\n    };\n  }\n\n  render() {\n    // on va remplir un tableau d'élément jsx\n    var roomsRender = [];\n    var content = this.props.content;\n    var date = this.props.date; // on scan chaque élément du json\n\n    content.forEach(element => {\n      // on récupère l'id pour pouvoir retrouver facilement les dates dans le composant frame360\n      var id = element.id;\n      var filename = element.filename;\n      var name = element.name; // on donne au parent un tableau contenant la page voulue et la photo 360\n      // on envoit d'abord vers le 360\n\n      var arrayReturn = [\"frame360\", id, filename, date]; // on remplit le tableau\n\n      roomsRender.push(React.createElement(\"div\", {\n        className: \"navRoomsFlex\",\n        onClick: () => this.props.page(arrayReturn),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 474\n        },\n        __self: this\n      }, React.createElement(ItemNavRooms, {\n        room: name,\n        filename: filename,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 474\n        },\n        __self: this\n      })));\n    });\n    return React.createElement(\"div\", {\n      className: \"lineNavRooms\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 478\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"navRoomsDate\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 479\n      },\n      __self: this\n    }, this.props.date), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 479\n      },\n      __self: this\n    }), React.createElement(\"nav\", {\n      className: \"navRooms\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 480\n      },\n      __self: this\n    }, roomsRender));\n  }\n\n}\n/*---------------------------------------------------------------\n\nIci on affiche plusieurs choses différentes selon l'état PAGE.\n- Si page vaut home on affiche le menu\n- Si page vaut frame360 on affiche la sphere draggable\n- Si page vaut frameVR on créé la scene VR\n\n------------------------------------------------------------------*/\n\n\nclass App extends Component {\n  constructor(props) {\n    super(props); // l'état par défaut de la page est home et il n'y a pas d'image sur la page home d'ou id, date et filename nuls\n\n    this.state = {\n      page: \"home\",\n      id: \"\",\n      filename: \"\",\n      date: \"\"\n    };\n    this.childHandler = this.childHandler.bind(this);\n  } // on récupère les infos de l'enfant, ici un tableau\n\n\n  childHandler(dataFromChild) {\n    var pageReturn = dataFromChild[0];\n    var idReturn = dataFromChild[1];\n    var filenameReturn = dataFromChild[2];\n    var dateReturn = dataFromChild[3];\n    this.setState({\n      page: pageReturn,\n      id: idReturn,\n      filename: filenameReturn,\n      date: dateReturn\n    });\n  }\n\n  render() {\n    // on va remplir un tableau d'élément jsx\n    var lineRender = []; // on scan chaque élément du json\n\n    rooms.forEach(element => {\n      // on récupère la date\n      var date = element.date; // on rédcupère le sous tableau correspondant à la date\n\n      var content = element.content; // on remplit le tableau qui récupère l'information du click de l'enfant\n\n      lineRender.push(React.createElement(LineNavRooms, {\n        page: this.childHandler,\n        date: date,\n        content: content,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 541\n        },\n        __self: this\n      }));\n    }); // on dispatch selon l'état\n\n    var page = this.state.page;\n\n    if (page == \"home\") {\n      var pageWrapper = React.createElement(\"section\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 547\n        },\n        __self: this\n      }, React.createElement(\"header\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 548\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 548\n        },\n        __self: this\n      }, \"HomeView | Questembert\")), React.createElement(\"section\", {\n        className: \"homeContainer\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 549\n        },\n        __self: this\n      }, lineRender));\n    } else if (page == \"frame360\") {\n      var pageWrapper = React.createElement(\"section\", {\n        className: \"FrameContainer\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 553\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"FrameReturn\",\n        onClick: () => this.setState({\n          page: \"home\"\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 554\n        },\n        __self: this\n      }, \"Retour\"), React.createElement(\"span\", {\n        className: \"goVR\",\n        onClick: () => this.setState({\n          page: \"frameVR\"\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 555\n        },\n        __self: this\n      }, \"Voir en VR\"), React.createElement(NavRoomDates, {\n        currentDate: this.state.date,\n        idRoom: this.state.id,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 556\n        },\n        __self: this\n      }), React.createElement(Frame360, {\n        filenameRoom: this.state.filename,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 557\n        },\n        __self: this\n      }));\n    } else if (page == \"frameVR\") {\n      var pageWrapper = React.createElement(\"section\", {\n        className: \"FrameContainer\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 561\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"FrameReturn\",\n        onClick: () => this.setState({\n          page: \"home\"\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 562\n        },\n        __self: this\n      }, \"Retour\"), React.createElement(FrameVR, {\n        room: this.state.filename,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 563\n        },\n        __self: this\n      }));\n    }\n\n    return React.createElement(\"section\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 568\n      },\n      __self: this\n    }, pageWrapper);\n  }\n\n}\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render(React.createElement(App, {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 577\n  },\n  __self: this\n}), rootElement);","map":{"version":3,"sources":["/Users/robinmarillia/Documents/dev/homeView/src/index.js"],"names":["React","Component","ReactDOM","THREE","WEBVR","rooms","NavRoomDatesItem","render","currentDate","props","idRoom","process","env","PUBLIC_URL","filename","date","NavRoomDates","navRender","forEach","element","content","id","filenameOtherDate","push","Frame360","constructor","frameRef","createRef","state","room","filenameRoom","componentDidMount","camera","scene","renderer","isUserInteracting","onMouseDownMouseX","onMouseDownMouseY","lon","onMouseDownLon","lat","onMouseDownLat","phi","theta","frame","init","appendChild","animate","mesh","PerspectiveCamera","window","innerWidth","innerHeight","target","Vector3","Scene","geometry","SphereBufferGeometry","scale","texture","TextureLoader","load","material","MeshBasicMaterial","map","Mesh","add","WebGLRenderer","setPixelRatio","devicePixelRatio","setSize","document","addEventListener","onPointerStart","onPointerMove","onPointerUp","onDocumentMouseWheel","event","preventDefault","dataTransfer","dropEffect","body","style","opacity","reader","FileReader","image","src","result","needsUpdate","readAsDataURL","files","onWindowResize","domElement","aspect","updateProjectionMatrix","clientX","touches","clientY","fov","deltaY","Math","clamp","requestAnimationFrame","update","max","min","degToRad","x","sin","cos","y","z","lookAt","ref","FrameVR","btnVRRef","returnInit","buttonVRRef","vr","enabled","layers","enable","createButton","referenceSpaceType","setAnimationLoop","ItemNavRooms","LineNavRooms","frameVRSize","roomsRender","name","arrayReturn","page","App","childHandler","bind","dataFromChild","pageReturn","idReturn","filenameReturn","dateReturn","setState","lineRender","pageWrapper","rootElement","getElementById"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport * as THREE from \"three\";\nimport { WEBVR } from 'three/examples/jsm/vr/WebVR.js';\nimport \"./index.css\";\nimport rooms from \"./json/rooms.json\";\n/*=================================================================\n                  STRUCTURE DES COMPOSANTS\n===================================================================\n\nOn navigue dans le composant App:\nSur la page d'accueil d'état HOME les scenes sont classées par date.\n\nOn a un composant qui génère une ligne de pièce par date.\n  Dans ce composant, un autre génère l'item clickable.\n\nAu clic on renvoit au composant App les informations de la scène cliquée.\nOn affiche alors un frame360 dont l'image est celle renvoyée par le click dans le menu.\n\n*/\n\n\n/*------------------------------------------------------------------------------\n\n  Cette classe génère l'affichage de l'item de navigation dans\n  une pièce à une date différente\n\n--------------------------------------------------------------------------------*/\n\n\nclass NavRoomDatesItem extends Component {\n\n  render(){\n    var currentDate = this.props.currentDate;\n    var idRoom = this.props.idRoom;\n    \n    return(\n      <div className=\"NavRoomDatesItem\">\n        <img src={process.env.PUBLIC_URL + '/img/'+this.props.filename}/>\n        <span>{this.props.date}</span>\n      </div>\n    )\n  }\n\n\n}\n\n/*------------------------------------------------------------------------------\n\n  Cette classe génère la liste des différentes dates de modification d'une pièce\n\n--------------------------------------------------------------------------------*/\n\n\nclass NavRoomDates extends Component {\n\n  render(){\n    var currentDate = this.props.currentDate;\n    var idRoom = this.props.idRoom;\n    var navRender = [];\n\n    // on scan chaque élément du json\n    rooms.forEach((element) => {\n      // on récupère la date\n      var date = element.date;\n      var content = element.content;\n\n\n      if(currentDate!=date){\n        if(content.id==idRoom){\n          var filenameOtherDate = content.filename;\n          navRender.push(<NavRoomDatesItem date={currentDate} filename={filenameOtherDate}/>)\n\n        }\n\n      }\n\n\n    });\n\n    return(\n      <div className=\"NavRoomDates\">{navRender}</div>\n    )\n  }\n\n\n}\n\n/*---------------------------------------------------------------\n\n            Cette classe génère la scène 360\n\n------------------------------------------------------------------*/\n\nclass Frame360 extends Component {\n  constructor(props) {\n    super(props);\n\n    // on initialise les refs\n    this.frameRef = React.createRef();\n\n    // on initialise les states\n    this.state = {\n        id: this.props.idRoom,\n        room: this.props.filenameRoom\n       };\n  }\n  componentDidMount() {\n\n    //this.setState({ renderer: WEBVR.createButton( renderer, { referenceSpaceType: 'local' } ) });\n    // on ajoute l'élément au composant react\n\n    var camera, scene, renderer;\n\n\t\tvar isUserInteracting = false,\n\t\t\t\tonMouseDownMouseX = 0, onMouseDownMouseY = 0,\n\t\t\t\tlon = 0, onMouseDownLon = 0,\n\t\t\t\tlat = 0, onMouseDownLat = 0,\n\t\t\t\tphi = 0, theta = 0;\n\n    // on récupère la room\n    var room = this.state.room;\n\n    // on active le frame\n    var frame = init(room);\n\n    this.frameRef.appendChild( frame );\n\t\tanimate();\n\n\n\n\n    function init(room) {\n\n        var mesh;\n\n\n        camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 1100 );\n        camera.target = new THREE.Vector3( 0, 0, 0 );\n\n        scene = new THREE.Scene();\n\n        var geometry = new THREE.SphereBufferGeometry( 500, 60, 40 );\n        // invert the geometry on the x-axis so that all of the faces point inward\n        geometry.scale( -1, 1, 1 );\n\n        var texture = new THREE.TextureLoader().load( process.env.PUBLIC_URL + '/img/'+room );\n\n        var material = new THREE.MeshBasicMaterial( { map: texture } );\n\n        mesh = new THREE.Mesh( geometry, material );\n\n        scene.add( mesh );\n\n        renderer = new THREE.WebGLRenderer();\n        renderer.setPixelRatio( window.devicePixelRatio );\n        renderer.setSize( window.innerWidth, window.innerHeight );\n\n        document.addEventListener( 'mousedown', onPointerStart, false );\n        document.addEventListener( 'mousemove', onPointerMove, false );\n        document.addEventListener( 'mouseup', onPointerUp, false );\n\n        document.addEventListener( 'wheel', onDocumentMouseWheel, false );\n\n        document.addEventListener( 'touchstart', onPointerStart, false );\n        document.addEventListener( 'touchmove', onPointerMove, false );\n        document.addEventListener( 'touchend', onPointerUp, false );\n\n\n        document.addEventListener( 'dragover', function ( event ) {\n\n          event.preventDefault();\n          event.dataTransfer.dropEffect = 'copy';\n\n        }, false );\n\n        document.addEventListener( 'dragenter', function () {\n\n          document.body.style.opacity = 0.5;\n\n        }, false );\n\n        document.addEventListener( 'dragleave', function () {\n\n          document.body.style.opacity = 1;\n\n        }, false );\n\n        document.addEventListener( 'drop', function ( event ) {\n\n          event.preventDefault();\n\n          var reader = new FileReader();\n          reader.addEventListener( 'load', function ( event ) {\n\n            material.map.image.src = event.target.result;\n            material.map.needsUpdate = true;\n\n          }, false );\n          reader.readAsDataURL( event.dataTransfer.files[ 0 ] );\n\n          document.body.style.opacity = 1;\n\n        }, false );\n\n        //\n\n        window.addEventListener( 'resize', onWindowResize, false );\n\n        return(renderer.domElement);\n      }\n\n\n    function onWindowResize() {\n\n        camera.aspect = window.innerWidth / window.innerHeight;\n        camera.updateProjectionMatrix();\n\n        renderer.setSize( window.innerWidth, window.innerHeight );\n\n      }\n\n    function onPointerStart( event ) {\n        isUserInteracting = true;\n\n        var clientX = event.clientX || event.touches[ 0 ].clientX;\n        var clientY = event.clientY || event.touches[ 0 ].clientY;\n\n        onMouseDownMouseX = clientX;\n        onMouseDownMouseY = clientY;\n\n        onMouseDownLon = lon;\n        onMouseDownLat = lat;\n\n      }\n\n    function onPointerMove( event ) {\n        if ( isUserInteracting === true ) {\n\n          var clientX = event.clientX || event.touches[ 0 ].clientX;\n          var clientY = event.clientY || event.touches[ 0 ].clientY;\n\n          lon = ( onMouseDownMouseX - clientX ) * 0.1 + onMouseDownLon;\n          lat = ( clientY - onMouseDownMouseY ) * 0.1 + onMouseDownLat;\n\n        }\n\n      }\n\n    function onPointerUp() {\n\n        isUserInteracting = false;\n\n      }\n\n    function onDocumentMouseWheel( event ) {\n        var fov = camera.fov + event.deltaY * 0.05;\n\n        camera.fov = THREE.Math.clamp( fov, 10, 75 );\n\n        camera.updateProjectionMatrix();\n\n      }\n\n    function animate() {\n\n\n        requestAnimationFrame( animate );\n        update();\n\n      }\n\n    function update() {\n\n        lat = Math.max( - 85, Math.min( 85, lat ) );\n        phi = THREE.Math.degToRad( 90 - lat );\n        theta = THREE.Math.degToRad( lon );\n\n        camera.target.x = 500 * Math.sin( phi ) * Math.cos( theta );\n        camera.target.y = 500 * Math.cos( phi );\n        camera.target.z = 500 * Math.sin( phi ) * Math.sin( theta );\n\n        camera.lookAt( camera.target );\n\n        /*\n        // distortion\n        camera.position.copy( camera.target ).negate();\n        */\n\n        renderer.render( scene, camera );\n\n      }\n\n  }\n\n\n  render() {\n    return (\n      <section>\n        <div className=\"itemRoom\" ref={ref => (this.frameRef = ref)} />\n      </section>\n    )\n  }\n}\n/*---------------------------------------------------------------\n\n                Cette classe génère la scène VR\n\n------------------------------------------------------------------*/\nclass FrameVR extends Component {\n  constructor(props) {\n    super(props);\n\n    // on initialise les refs\n    this.frameRef = React.createRef();\n    this.btnVRRef = React.createRef();\n\n    // on initialise les états\n    this.state = {\n       room: this.props.room\n       };\n  }\n  componentDidMount() {\n\n\n    // on récupère la room\n    var room = this.state.room;\n\n    // on active le frame\n    var returnInit = init(room);\n\n    // on ajoute le renderer\n    this.frameRef.appendChild( returnInit[0] );\n\n    // on ajoute le bouton VR enable\n    this.buttonVRRef.appendChild( returnInit[1] );\n\n    var camera;\n  \tvar renderer;\n  \tvar scene;\n\n  \tanimate();\n\n  \tfunction init(room) {\n\n  \t\trenderer = new THREE.WebGLRenderer();\n  \t\trenderer.setPixelRatio( window.devicePixelRatio );\n  \t\trenderer.setSize( window.innerWidth, window.innerHeight );\n  \t\trenderer.vr.enabled = true;\n\n  \t\tscene = new THREE.Scene();\n\n  \t\tcamera = new THREE.PerspectiveCamera( 90, window.innerWidth / window.innerHeight, 1, 1000 );\n  \t\tcamera.layers.enable( 1 );\n\n      var geometry = new THREE.SphereBufferGeometry( 500, 60, 40 );\n      // invert the geometry on the x-axis so that all of the faces point inward\n      geometry.scale( -1, 1, 1 );\n\n      var texture = new THREE.TextureLoader().load( process.env.PUBLIC_URL + '/img/'+room );\n\n      var material = new THREE.MeshBasicMaterial( { map: texture } );\n\n      var mesh = new THREE.Mesh( geometry, material );\n\n      scene.add( mesh );\n\n  \t\twindow.addEventListener( 'resize', onWindowResize, false );\n\n      // on retourne les éléments à ajouter au dom\n  \t\treturn [renderer.domElement, WEBVR.createButton( renderer, { referenceSpaceType: 'local' } )];\n\n  \t}\n\n\n  \tfunction onWindowResize() {\n\n  \t\tcamera.aspect = window.innerWidth / window.innerHeight;\n  \t\tcamera.updateProjectionMatrix();\n\n  \t\trenderer.setSize( window.innerWidth, window.innerHeight );\n\n  \t}\n\n  \tfunction animate() {\n\n  \t\trenderer.setAnimationLoop( render );\n\n  \t}\n\n  \tfunction render() {\n\n  \t\trenderer.render( scene, camera );\n\n  \t}\n\n\n\n  }\n\n\n  render() {\n    return (\n        <section>\n          <div className=\"itemRoom\" ref={ref => (this.frameRef = ref)} />\n          <div className=\"vrEnabled\" ref={ref => (this.buttonVRRef = ref)}/>\n        </section>\n    )\n  }\n}\n\n\n\n\n/*---------------------------------------------------------------\n\nCette classe génère un item de la ligne de pièce\n\n------------------------------------------------------------------*/\nclass ItemNavRooms extends Component {\n\n  render(){\n    var filename = process.env.PUBLIC_URL + '/img/'+this.props.filename;\n    return(\n      <div className=\"navRoomItem\">\n        <div className=\"navRoomItemTitle\">{this.props.room}</div>\n        <img src={filename}/>\n      </div>\n    )\n\n  }\n\n\n}\n\n/*---------------------------------------------------------------\n\nCette classe génère une ligne de pièces en fonction d'une date\ndonnée par le parent\n\n------------------------------------------------------------------*/\nclass LineNavRooms extends Component {\n  constructor(props) {\n      super(props)\n      this.state = {\n          frameVRSize: \"small\",\n          room: \"room4-salon-291019.JPG\"\n      };\n  }\n\n\n\n\n  render() {\n\n    // on va remplir un tableau d'élément jsx\n    var roomsRender = [];\n    var content = this.props.content;\n    var date = this.props.date;\n    // on scan chaque élément du json\n    content.forEach((element) => {\n\n      // on récupère l'id pour pouvoir retrouver facilement les dates dans le composant frame360\n      var id = element.id;\n      var filename = element.filename;\n\n      var name = element.name;\n\n      // on donne au parent un tableau contenant la page voulue et la photo 360\n      // on envoit d'abord vers le 360\n      var arrayReturn = [\"frame360\", id, filename, date];\n\n      // on remplit le tableau\n      roomsRender.push(<div className=\"navRoomsFlex\" onClick={()=> this.props.page(arrayReturn)} ><ItemNavRooms room={name} filename={filename}/></div>);\n    });\n\n    return (\n      <div className=\"lineNavRooms\">\n        <div className=\"navRoomsDate\">{this.props.date}</div><br/>\n        <nav className=\"navRooms\">\n          {/*<SelectRoom action={this.childHandler}/>*/}\n\n          {roomsRender}\n        </nav>\n      </div>\n    )\n  }\n}\n/*---------------------------------------------------------------\n\nIci on affiche plusieurs choses différentes selon l'état PAGE.\n- Si page vaut home on affiche le menu\n- Si page vaut frame360 on affiche la sphere draggable\n- Si page vaut frameVR on créé la scene VR\n\n------------------------------------------------------------------*/\nclass App extends Component {\n  constructor(props) {\n      super(props)\n      // l'état par défaut de la page est home et il n'y a pas d'image sur la page home d'ou id, date et filename nuls\n      this.state = {\n          page: \"home\",\n          id: \"\",\n          filename: \"\",\n          date: \"\"\n\n      };\n      this.childHandler = this.childHandler.bind(this)\n  }\n\n\n  // on récupère les infos de l'enfant, ici un tableau\n  childHandler(dataFromChild) {\n\n        var pageReturn = dataFromChild[0];\n        var idReturn = dataFromChild[1];\n        var filenameReturn = dataFromChild[2];\n        var dateReturn = dataFromChild[3];\n        this.setState({\n            page: pageReturn,\n            id: idReturn,\n            filename: filenameReturn,\n            date: dateReturn\n        });\n\n  }\n\n  render() {\n\n    // on va remplir un tableau d'élément jsx\n    var lineRender = [];\n    // on scan chaque élément du json\n    rooms.forEach((element) => {\n      // on récupère la date\n      var date = element.date;\n\n      // on rédcupère le sous tableau correspondant à la date\n      var content = element.content;\n\n      // on remplit le tableau qui récupère l'information du click de l'enfant\n      lineRender.push(<LineNavRooms page={this.childHandler} date={date} content={content}/>);\n    });\n\n    // on dispatch selon l'état\n    var page = this.state.page;\n    if(page==\"home\"){\n      var pageWrapper = <section>\n                          <header><span>HomeView | Questembert</span></header>\n                          <section className=\"homeContainer\">{lineRender}</section>\n                        </section>\n    }\n    else if(page==\"frame360\"){\n      var pageWrapper = <section className=\"FrameContainer\">\n                          <span className=\"FrameReturn\" onClick={()=>this.setState({page:\"home\"})}>Retour</span>\n                          <span className=\"goVR\" onClick={()=>this.setState({page:\"frameVR\"})}>Voir en VR</span>\n                          <NavRoomDates currentDate={this.state.date} idRoom={this.state.id}/>\n                          <Frame360 filenameRoom={this.state.filename}/>\n                        </section>\n    }\n    else if(page==\"frameVR\"){\n      var pageWrapper = <section className=\"FrameContainer\">\n                          <span className=\"FrameReturn\" onClick={()=>this.setState({page:\"home\"})}>Retour</span>\n                          <FrameVR room={this.state.filename}/>\n                        </section>\n    }\n\n    return (\n      <section>\n\n        {pageWrapper}\n      </section>\n    )\n  }\n}\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render(<App />, rootElement);\n"]},"metadata":{},"sourceType":"module"}